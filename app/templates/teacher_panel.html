<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Panel - C Programming Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
        }

        .logout-button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }

        .logout-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .game-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .button-primary {
            background: #4CAF50;
            color: white;
        }

        .button-primary:hover {
            background: #45a049;
        }

        .button-danger {
            background: #f44336;
            color: white;
        }

        .button-danger:hover {
            background: #da190b;
        }

        .button-secondary {
            background: #2196F3;
            color: white;
        }

        .button-secondary:hover {
            background: #0b7dda;
        }

        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .timer-section {
            margin-bottom: 20px;
        }

        .timer-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-top: 10px;
        }

        .timer-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .game-status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .questions-section {
            grid-column: 1 / -1;
        }

        .questions-list {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .question-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .question-item.current {
            border-color: #4CAF50;
            background: #f0fff0;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .question-title {
            font-weight: bold;
            color: #333;
            font-size: 1.1rem;
        }

        .question-actions {
            display: flex;
            gap: 10px;
        }

        .question-description {
            color: #666;
            margin-bottom: 10px;
        }

        .question-hint {
            color: #888;
            font-style: italic;
            font-size: 0.9rem;
        }

        .expected-output {
            background: #1e1e1e;
            color: #4CAF50;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .add-question-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 80px;
            resize: vertical;
            font-family: monospace;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .leaderboard-table th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .rank {
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üë©‚Äçüè´ Teacher Control Panel</h1>
            <button class="logout-button" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="container">
        <div class="dashboard">
            <!-- Game Controls -->
            <div class="card">
                <h2>üéÆ Game Controls</h2>
                
                <div id="gameStatus" class="game-status status-inactive">
                    No active game
                </div>

                <div class="timer-section">
                    <label for="timerInput">Question Timer (minutes):</label>
                    <input type="number" id="timerInput" class="timer-input" min="1" max="60" value="5" placeholder="Enter timer in minutes">
                </div>

                <div class="game-controls">
                    <button id="startGameBtn" class="button button-primary" onclick="startGame()">
                        üöÄ Start New Game
                    </button>
                    <button id="nextQuestionBtn" class="button button-secondary" onclick="nextQuestion()" disabled>
                        ‚û°Ô∏è Next Question
                    </button>
                    <button id="stopGameBtn" class="button button-danger" onclick="stopGame()" disabled>
                        ‚èπÔ∏è Stop Game
                    </button>
                </div>
            </div>

            <!-- Live Leaderboard -->
            <div class="card">
                <h2>üèÜ Live Leaderboard</h2>
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Student</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr>
                            <td colspan="3" style="text-align: center; color: #666;">No active game</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Questions Management -->
            <div class="card questions-section">
                <h2>üìù Question Bank</h2>
                
                <div id="questionsList" class="questions-list">
                    <!-- Questions will be loaded here -->
                </div>

                <div class="add-question-form">
                    <h3>Add New Question</h3>
                    <div class="form-group">
                        <label for="questionTitle">Title:</label>
                        <input type="text" id="questionTitle" placeholder="e.g., Hello World">
                    </div>
                    <div class="form-group">
                        <label for="questionDescription">Description:</label>
                        <textarea id="questionDescription" placeholder="Describe what the student should do..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="questionHint">Hint:</label>
                        <input type="text" id="questionHint" placeholder="Give students a helpful hint...">
                    </div>
                    <div class="form-group">
                        <label for="expectedOutput">Expected Output:</label>
                        <textarea id="expectedOutput" placeholder="Exact output expected (use 'variable' for flexible validation)"></textarea>
                    </div>
                    <button class="button button-primary" onclick="addQuestion()">Add Question</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let questions = [];
        let gameActive = false;
        let currentQuestionIndex = -1;

        // Initialize
        window.addEventListener('load', function() {
            loadQuestions();
            updateGameStatus();
            setInterval(updateLeaderboard, 3000); // Update every 3 seconds
        });

        function loadQuestions() {
            // Load default questions
            questions = [
                {
                    id: 1,
                    title: "Hello World",
                    description: "Write a program that prints 'Hello, World!' to the screen.",
                    hint: "Use printf() to print text",
                    expected_output: "Hello, World!\n"
                },
                {
                    id: 2,
                    title: "Simple Addition",
                    description: "Write a program that prints the result of 5 + 3.",
                    hint: "Calculate 5 + 3 and print the result",
                    expected_output: "8\n"
                },
                {
                    id: 3,
                    title: "Variables Demo",
                    description: "Create two integer variables (a=10, b=20) and print their sum.",
                    hint: "Declare int variables and use printf to show their sum",
                    expected_output: "30\n"
                },
                {
                    id: 4,
                    title: "Simple Loop",
                    description: "Print numbers 1 to 5, each on a new line.",
                    hint: "Use a for loop from 1 to 5",
                    expected_output: "1\n2\n3\n4\n5\n"
                },
                {
                    id: 5,
                    title: "Print Your Name",
                    description: "Write a program that prints your name.",
                    hint: "Use printf() with any name",
                    expected_output: "variable"
                }
            ];
            displayQuestions();
        }

        function displayQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = '';

            questions.forEach((question, index) => {
                const isCurrent = gameActive && index === currentQuestionIndex;
                const questionDiv = document.createElement('div');
                questionDiv.className = `question-item ${isCurrent ? 'current' : ''}`;
                
                questionDiv.innerHTML = `
                    <div class="question-header">
                        <div class="question-title">${question.title}</div>
                        <div class="question-actions">
                            <button class="button button-danger" onclick="deleteQuestion(${question.id})" style="padding: 5px 10px; font-size: 12px;">Delete</button>
                        </div>
                    </div>
                    <div class="question-description">${question.description}</div>
                    <div class="question-hint">üí° ${question.hint}</div>
                    <div class="expected-output">Expected: ${question.expected_output === 'variable' ? '(Any output)' : question.expected_output}</div>
                `;
                
                container.appendChild(questionDiv);
            });
        }

        function addQuestion() {
            const title = document.getElementById('questionTitle').value.trim();
            const description = document.getElementById('questionDescription').value.trim();
            const hint = document.getElementById('questionHint').value.trim();
            const expectedOutput = document.getElementById('expectedOutput').value;

            if (!title || !description || !hint) {
                alert('Please fill in all fields');
                return;
            }

            const newQuestion = {
                id: Date.now(), // Simple ID generation
                title: title,
                description: description,
                hint: hint,
                expected_output: expectedOutput || 'variable'
            };

            questions.push(newQuestion);
            displayQuestions();

            // Clear form
            document.getElementById('questionTitle').value = '';
            document.getElementById('questionDescription').value = '';
            document.getElementById('questionHint').value = '';
            document.getElementById('expectedOutput').value = '';
        }

        function deleteQuestion(id) {
            if (confirm('Are you sure you want to delete this question?')) {
                questions = questions.filter(q => q.id !== id);
                displayQuestions();
            }
        }

        async function startGame() {
            if (questions.length === 0) {
                alert('Please add at least one question before starting a game');
                return;
            }

            const timer = parseInt(document.getElementById('timerInput').value) || 5;

            try {
                const response = await fetch('/api/game/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        questions: questions,
                        timer: timer
                    })
                });

                const result = await response.json();
                if (result.success) {
                    gameActive = true;
                    currentQuestionIndex = 0;
                    updateGameStatus();
                    displayQuestions();
                    alert('Game started! Students can now join.');
                }
            } catch (error) {
                alert('Failed to start game: ' + error.message);
            }
        }

        async function nextQuestion() {
            try {
                const response = await fetch('/api/game/next', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                if (result.success) {
                    currentQuestionIndex++;
                    updateGameStatus();
                    displayQuestions();
                }
            } catch (error) {
                alert('Failed to go to next question: ' + error.message);
            }
        }

        async function stopGame() {
            if (confirm('Are you sure you want to stop the current game?')) {
                try {
                    const response = await fetch('/api/game/stop', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    const result = await response.json();
                    if (result.success) {
                        gameActive = false;
                        currentQuestionIndex = -1;
                        updateGameStatus();
                        displayQuestions();
                        alert('Game stopped.');
                    }
                } catch (error) {
                    alert('Failed to stop game: ' + error.message);
                }
            }
        }

        function updateGameStatus() {
            const statusDiv = document.getElementById('gameStatus');
            const startBtn = document.getElementById('startGameBtn');
            const nextBtn = document.getElementById('nextQuestionBtn');
            const stopBtn = document.getElementById('stopGameBtn');

            if (gameActive) {
                statusDiv.className = 'game-status status-active';
                statusDiv.textContent = `Active - Question ${currentQuestionIndex + 1} of ${questions.length}`;
                startBtn.disabled = true;
                nextBtn.disabled = currentQuestionIndex >= questions.length - 1;
                stopBtn.disabled = false;
            } else {
                statusDiv.className = 'game-status status-inactive';
                statusDiv.textContent = 'No active game';
                startBtn.disabled = false;
                nextBtn.disabled = true;
                stopBtn.disabled = true;
            }
        }

        async function updateLeaderboard() {
            if (!gameActive) return;

            try {
                const response = await fetch('/api/leaderboard');
                const leaderboard = await response.json();
                displayLeaderboard(leaderboard);
            } catch (error) {
                console.error('Failed to update leaderboard:', error);
            }
        }

        function displayLeaderboard(leaderboard) {
            const tbody = document.getElementById('leaderboardBody');
            tbody.innerHTML = '';

            if (leaderboard.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666;">No participants yet</td></tr>';
                return;
            }

            leaderboard.forEach((student, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="rank">#${index + 1}</td>
                    <td>${student.nickname}</td>
                    <td>${student.score}</td>
                `;
                tbody.appendChild(row);
            });
        }

        async function logout() {
            try {
                await fetch('/api/teacher/logout', { method: 'POST' });
                window.location.href = '/teacher';
            } catch (error) {
                window.location.href = '/teacher';
            }
        }
    </script>
</body>
</html>